<%= render 'shared/nav' %>


<div style="width:100vw;">
    <span style="width:40%">
        <p><%= @listing.address %></p>
        <p><%= @listing.user.email %></p>
        <p><%= @listing.description %></p>

        <p>rating: <%= "⭐" * @listing.rating %></p>

        <p>
            <% if can? :edit, @listing %>
            
                <% if @listing.available %>
                    <%= link_to 'make unavailable', change_path(@listing) %>
                <% else %>
                    <%= link_to 'make available', change_path(@listing) %>
                <% end %>

                <%= link_to 'edit', edit_listing_path(@listing) %>
                <%= link_to 'delete', delete_listing_path(@listing), method: :delete %>
            <% end %>
        </p>
    </span>

    <span style="height:100%; width:40%">
        <%= image_tag(@listing.picture, sizes:"100%") if @listing.picture.attached? %>
    </span>
</div>

<%= render 'shared/map', listings: [@listing] %>

<p>Book this parking space:</p>

<%= form_with scope: :booking, local: true, url: payment_path(@listing) do |f| %>
    <%= f.label "book this listing for $#{@listing.price / 100.0} per hour for" %>
    <%= f.number_field(:time, in: 1..24, step: 1) %> hours
    <%= f.submit %>
<% end %>

<br>
<p>New review:</p>
<% if can? :create, Review %>
    <%= form_with scope: :review, local: true do |f| %>
        <%= f.label :review %>
        <%= f.text_field :review %>
        <%= f.label :rating %>
        <%= f.number_field(:rating, in: 1..5, step: 1) %>
        <%= f.submit %>
    <% end %>
<% else %>
    <p>Please log in to add a review</p>
<% end %>
<br>

<p>Reviews:</p>

<% @listing.reviews.each do |review| %>
    <div>
        <p><%= review.review %> </p>
        <p><%= review.user.email %>    <%= "⭐" * review.rating%></p>
        <% if review.user == current_user %>
            <%= link_to 'edit', edit_review_path(@listing, review) %>
            <%= link_to 'delete', destroy_review_path(@listing, review), method: :delete %>
        <% end %>
    </div>
    <br>
<% end %>

